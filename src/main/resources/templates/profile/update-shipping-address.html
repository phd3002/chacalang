<!DOCTYPE html>
<html lang="vn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ giao h√†ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
    <link href="https://fonts.googleapis.com/css?family=Quicksand:400,700%7CCabin:400%7CDancing+Script"
          rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/account/account.css}">
    <style>
        /* Style cho form ƒë·ªãa ch·ªâ - gi·ªõi h·∫°n chi·ªÅu r·ªông v√† cƒÉn gi·ªØa form */
        .address-form {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* T·∫°o kho·∫£ng c√°ch gi·ªØa c√°c nh√≥m form */
        .form-group {
            margin-bottom: 20px;
        }

        /* Style cho label c·ªßa form - l√†m n·ªïi b·∫≠t v√† d·ªÖ ƒë·ªçc */
        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        /* Style cho c√°c input v√† select - t·∫°o vi·ªÅn v√† padding ph√π h·ª£p */
        .form-control {
            border-radius: 4px;
            border: 1px solid #ddd;
            padding: 10px;
        }

        /* Hi·ªáu ·ª©ng focus cho input v√† select - t·∫°o vi·ªÅn xanh khi focus */
        .form-control:focus {
            border-color: #1976d2;
            box-shadow: 0 0 0 0.2rem rgba(25, 118, 210, 0.25);
        }

        /* Style cho n√∫t submit - m√†u xanh d∆∞∆°ng v√† hi·ªáu ·ª©ng hover */
        .btn-submit {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn-submit:hover {
            background: #1565c0;
        }

        /* Style cho n√∫t cancel - m√†u x√°m v√† hi·ªáu ·ª©ng hover */
        .btn-cancel {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            margin-left: 10px;
            transition: background 0.3s;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        /* Style cho ph·∫ßn ch·ªçn lo·∫°i ƒë·ªãa ch·ªâ (m·∫∑c ƒë·ªãnh/ph·ª•) */
        .address-type {
            margin-bottom: 20px;
        }

        .address-type label {
            margin-right: 20px;
        }
    </style>
</head>
<body>
<div th:replace="~{base :: header}"></div>
<br><br>
<div class="profile-section">
    <div class="container">
        <div class="row justify-content-center align-items-start">
            <!-- Sidebar -->
            <div class="col-md-3 d-flex justify-content-center mb-4 mb-md-0">
                <div class="account-sidebar">
                    <div class="sidebar-title">T√ÄI KHO·∫¢N C·ª¶A T√îI</div>
                    <ul class="sidebar-menu">
                        <li><a href="/user/profile-manager"><i class="fa fa-user-circle"></i>QU·∫¢N L√ù T√ÄI KHO·∫¢N</a></li>
                        <li><a href="/user/orders"><i class="fa fa-shopping-bag"></i>ƒê∆†N H√ÄNG C·ª¶A T√îI</a></li>
                        <li class="active"><a href="/user/user-address"><i class="fa fa-map-marker"></i>ƒê·ªäA CH·ªà GIAO
                            H√ÄNG</a></li>
                        <li><a href="/user/profile"><i class="fa fa-info-circle"></i>TH√îNG TIN T√ÄI KHO·∫¢N</a></li>
                        <li><a href="#"><i class="fa fa-gift"></i>DANH S√ÅCH ∆ØU ƒê√ÉI</a></li>
                    </ul>
                </div>
            </div>
            <!-- Main Content -->
            <div class="col-md-8">
                <div class="profile-wrapper">
                    <div class="section-header text-center">
                        <h2 class="title"
                            th:text="${address != null and address.id != null ? 'C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ giao h√†ng' : 'Th√™m ƒë·ªãa ch·ªâ giao h√†ng'}">
                            C·∫≠p nh·∫≠t ƒë·ªãa ch·ªâ giao h√†ng
                        </h2>
                        <hr>
                    </div>
                    <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>
                    <div class="alert alert-success" th:if="${success}" th:text="${success}"></div>
                    <form id="addressForm" th:action="@{/user/update-address}" method="post" class="address-form">
                        <input type="hidden" name="id" th:value="${address.id}"/>

                        <div class="form-group">
                            <label>H·ªç v√† t√™n:</label>
                            <input class="form-control" name="fullName" th:value="${address.fullName}" required/>
                        </div>

                        <div class="form-group">
                            <label>S·ªë ƒëi·ªán tho·∫°i:</label>
                            <input class="form-control" name="phone" th:value="${address.phone}" required/>
                        </div>

                        <div class="form-group">
                            <label>Qu·∫≠n/Huy·ªán:</label>
                            <select class="form-control" name="districtId" id="districtId" required>
                                <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
                                <th:block th:each="d : ${districts}">
                                    <option th:value="${d.id}" th:text="${d.name}"
                                            th:selected="${address.district != null and d.id == address.district.id}"></option>
                                </th:block>
                            </select>
                        </div>

                        <div class="form-group" th:if="${not #lists.isEmpty(wards)}">
                            <label>Ph∆∞·ªùng/X√£:</label>
                            <select class="form-control" name="wardId" id="wardId" required>
                                <option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>
                                <th:block th:each="w : ${wards}">
                                    <option th:value="${w.id}" th:text="${w.name}"
                                            th:selected="${address.ward != null and w.id == address.ward.id}"></option>
                                </th:block>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ƒê·ªãa ch·ªâ chi ti·∫øt:</label>
                            <input class="form-control" name="address" th:value="${address.address}" required/>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="isDefault" value="true"
                                       th:checked="${address.isDefault}"/>
                                ƒê·∫∑t l√†m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh
                            </label>
                        </div>

                        <div class="form-group text-center">
                            <button type="submit" class="btn-submit">L∆∞u ƒë·ªãa ch·ªâ</button>
                            <a href="/user/user-address" class="btn-cancel">H·ªßy</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="~{base :: footer}"></div>
<script referrerpolicy="no-referrer"
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
    $('#districtId').on('change', function () {
        var districtId = $(this).val();
        var $ward = $('#wardId');
        // L∆∞u l·∫°i wardId c≈© n·∫øu c√≥
        var oldWardId = $ward.val();
        $ward.empty();
        $ward.append('<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>');
        if (districtId) {
            $.ajax({
                url: '/api/user-address/wards?districtId=' + districtId,
                type: 'GET',
                success: function (data) {
                    data.forEach(function (item) {
                        $ward.append('<option value="' + item.id + '">' + item.name + '</option>');
                    });
                    // N·∫øu oldWardId c√≤n trong danh s√°ch th√¨ set l·∫°i
                    if (oldWardId && $ward.find('option[value="' + oldWardId + '"]').length > 0) {
                        $ward.val(oldWardId);
                    }
                }
            });
        }
    });
</script>


<!--<script th:inline="javascript">-->
<!--    const host = "/api/location";-->
<!--    let selectedWard = /*[[${address.ward != null ? '"' + address.ward.id + '"' : '""'}]]*/ "";-->
<!--    const renderWards = (data) => {-->
<!--        const wardSelect = document.getElementById("ward");-->
<!--        let options = '<option value="">Ch·ªçn ph∆∞·ªùng/x√£</option>';-->
<!--        data.forEach(w => {-->
<!--            options += `<option value="${w.name}">${w.name}</option>`;-->
<!--        });-->
<!--        wardSelect.innerHTML = options;-->

<!--        if (selectedWard) {-->
<!--            wardSelect.value = selectedWard;-->
<!--        }-->
<!--    };-->

<!--    document.getElementById("district").addEventListener("change", function () {-->
<!--        const districtId = this.value;-->
<!--        document.querySelector("input[name='district']").value = this.options[this.selectedIndex].text;-->

<!--        // üî• Redirect ƒë·ªÉ n·∫°p l·∫°i form k√®m districtId-->
<!--        const currentUrl = window.location.origin + window.location.pathname;-->
<!--        const urlParams = new URLSearchParams(window.location.search);-->
<!--        urlParams.set("districtId", districtId);-->
<!--        const idParam = document.querySelector("input[name='id']");-->
<!--        if (idParam) urlParams.set("id", idParam.value);-->

<!--        window.location.href = `${currentUrl}?${urlParams.toString()}`;-->
<!--    });-->
<!--</script>-->

</body>
</html> 